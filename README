
  Overview
  ********

    The Autonomous Digital Adding Machine 1, or short ADAM/1, is an electronic
    digital computer based on 7400 series integrated circuits.

    The CPU implements a microprogrammable CISC instruction set.
    It can address 16 bit words within a 16 bit address range.
    Programm and data are not stored in the same address space (Von
    Neumann architecture).

    The initial design was sketched out on multiple napkins during a lunch
    break and is still awaiting completion. For now, the files in this
    directory contain a transcribed, sanitized subset of the design.


  CPU Design
  **********
      _____________________________________
     |  _________________________________  |
     | |    ___              _____       | |       ____
     | |_|\|   |__________|\|     |/|__|\| |      |_R0_|
     |  _  | A |______   _  | I/O |  __  | |      |_R1_|
     | | |/|___|      | | |/|_____|\|  |/| |      |_R2_|
     | |              | |    _____       | |/|__|\|_R3_|
     | |              | |_|\|     |/|__|\| |  __  |_R4_|
     | |              |  _  | RAM |  __  | |\|  |/|_R5_|
     | |              | | |/|_____|\|  |/| |      |_R6_|
     | |    ___       | |                | |      |_R7_|
     | |_|\|   |______|_|______________|\| |     Register
     |___  | B |_   ___________________  | |       File
         |/|___| | |  | |              |/| |
                 | |  | |    _______     | |       _____
                 | |__|_|_|\|       |__|\| |/|__|\|     |
                 |  ______  | SHIFT |__  | |  __  | PSW |
                 | |  | | |/|_______|  |/| |\|  |/|_____|
                 | |  | |    _____       | |
                 | |  | |_|\|     |      | |       ___________
                 | |  |  _  | AND |____|\| |/|____|           |
                 | |  | | |/| OR  |____  | |  ____| Constants |
                 | |__|_|_|\| XOR |    |/| |\|    |___________|
                 |  ______  |     |      | |
                 | |  | | |/|_____|      | |
                 | |  | |    _____       | |
                 | |  | |_|\|     \      | |
                 | |  |___  |__    \ __|\| |
                 | |      |/   \ +  \__  | |
                 | |______|\ __/ -  /  |/|_|
                 |________  |      /
                          |/|_____/
                         Adder/Subtractor


    This drawing outlines the CPU architecture as seen by a programmer. The
    registers "A" and "B" are internal temporary registers that are not
    directly accessible by software and are used by the control logic for
    storing operands and intermediate results.

    The "PSW" file contains the processor status word and the block
    "Constants" contains various constant values used by the CPU.

    The CPU has a register file containing 8 registers. Most of them can be
    used for general purpose computations, but R7 is used by the control logic
    as program counter, R6 as a kernel mode stack pointer and R5 as user mode
    stack pointer.




    Below is a drawing illustrating the actual hardware design that
    implements the CPU architecture.


                                .
            HIGHER-HALF         .     LOWER-HALF
                                .
                                .
                      TRI-STATE . TRI-STATE
                         BUS    .    BUS
             ___          _     .     _          ___
            |   |/|____|\| |    .    | |/|____|\|   |
            | S |  ____  | |    .    | |  ____  | S |
            |___|\|    |/| |    .    | |\|    |/|___|
            SHIFT        | |    .    | |        SHIFT
          REGISTER       | |    .    | |      REGISTER
        ________         | |    .    | |         ________
       | LOGIC  |/|____|\| |    .    | |/|____|\| LOGIC  |
       | MODULE |  ____  | |    .    | |  ____  | MODULE |
       |________|\|    |/| |    .    | |\|    |/|________|
        ________         | |    .    | |         ________
       | ADDER  |/|____|\| |    .    | |/|____|\| ADDER  |
       | MODULE |  ____  | |    .    | |  ____  | MODULE |
       |________|\|    |/| |    .    | |\|    |/|________|
     ___________         | |    .    | |         ___________
    | CONSTANTS |/|____|\| |    .    | |/|____|\| CONSTANTS |
    |  MODULE   |  ____  | |    .    | |  ____  |  MODULE   |
    |___________|\|    |/| |    .    | |\|    |/|___________|
      __________         | |    .    | |         __________
     | REGISTER |/|____|\| |    .    | |/|____|\| REGISTER |
     |  MODULE  |  ____  | |    .    | |  ____  |  MODULE  |
     |__________|\|    |/| |    .    | |\|    |/|__________|
  ______________         | |    .    | |         ______________
 | MEMORY & I/O |/|____|\| |    .    | |/|____|\| MEMORY & I/O |
 |    MODULE    |  ____  | |    .    | |  ____  |    MODULE    |
 |______________|\|    |/| |    .    | |\|    |/|______________|
                         | |    .    | |         ________
                         | |    .    | |/|______| DECODE |
                         | |    .    | |  ______| MODULE |
                         | |    .    | |\|      |________|
                         | |    .    | |           A
                        _| |_   .   _| |_          |
                      __\___/_______\___/__        |
                     |                     |<------+
                     |    CONTROL LOGIC    |
                     |_____________________|


    Most of the CPU utilizes a bit-slice design and consits of individual
    8 bit modules that can be cascaded. The 8 bit modules are wired to a
    common bus using 2*20 pin connectors. The central control logic has to
    merge two such busses in order to build a 16 bit CPU.

    The module bus itself consits of an 8 bit tri-state data bus and a bunch
    of control lines.

    Every modules has two temporary operand registers, A and B. There are two
    control lines for the operand registers, one for all A registers and one
    for all B registers. A rising edge on one of those lines causes all
    modules to latch the current data bus word into the A or B register.

    The result generated by each module is "held back" by a tri-state buffer.
    Every board can be triggered individually to write its output onto the
    data bus.

  1) Shift register module

     BUS
     | | SOUT
     | |<---------+
     | |          |
     | |/|________|__________________________
     | |  _________________________________  |
     | |\|   ___  |LSB      ___________    | |
     | |__|\|   |_|______|\|           |___| |
     | |__  | B |___   __  | Tri-state |___  |
     | |  |/|___|   | |  |/|   Buffer  |   | |
     | |            | |    |___________|   | |
     | |            | |     ___________    | |
     | |            | |__|\|           |___| |
     | |            |____  | Tri-state |_____|
     | | SIN             |/|   Buffer  |
     | |------------------>|___________|
     | |              MSB

    The shift register module contains only a B register (74HC574), connected
    to a 74HC245 output buffer, displaced by one line to implement a right
    shift operation. The MSB of the 74HC245 input is connected with the SIN
    line of the bus to ripple the LSB of the next stage through, while the LSB
    of the 74HC574 is connected to the SOUT line of the bus to get rippled
    through to the next lower stage.

    There is a second 74HC245, connected directly to the 74HC574 without
    displacement to allow the register to be used as temporary register for
    intermediate results. The two buffers can be triggered seperately, the
    shift buffer via the bus SHIFT line, the temporary register buffer via the
    bus TEMP line.

    The module only implements right shift/rotate as a left shift/rotate can
    be implemented by adding a number to itself.

  2) Logic module

     BUS
     | |
     | |/|_____________________________________________
     | |  ___________________________________________  |
     | |\|   ___      __________      ___________    | |
     | |__|\|   |__|\|          |    |           |___| |
     | |__  | A |__  | Bitwise  |__|\| Tri-state |_____|
     | |  |/|___|  |/|  Logic   |__  |   Buffer  |
     | |__|\|   |__|\| Function |  |/|___________|
     | |__  | B |__  |          |
     | |  |/|___|  |/|__________|
     | |


    The logic module has the A and B registers wired up to two 74HC logic
    gate ICs, like a 74HC08, 74HC32, 74HC86 or anything pin compatible.

    The logic module output enable is connected to a set of jumpers, allowing
    one of four control lines to be used, so multiple logic modules with
    different logic gates can be installed in a system.

  3) Adder module

     BUS
     | |
     | |/|_______________________________________________________
     | |  _____________________________________________________  |
     | |\|             ___      _____           ___________    | |
     | |____________|\|   |__|\|     \         |           |___| |
     | |____________  | A |__  |__    \ _____|\| Tri-state |_____|
     | |    _____   |/|___|  |/   \ +  \_____  |   Buffer  |
     | |_|\|     |__|\|   |__|\ __/    /     |/|___________|
     | |_  | NOT |__  | B |__  |      /
     | | |/|_____|  |/|___|  |/|_____/
     | |


    The adder module feeds the A and B register through two cascaded 74HC283
    adder ICs.

    In addition to the A, B and output control lines, the adder module has the
    total carry input and carry output connected to the bus to allow cascading
    of multiple adder modules.

    An additional control line allows the B register to be inverted BEFORE
    being latched, allowing the adder to be used for twos complement
    subtracting.

  4) Register module

    BUS
    | |/|_____________
    | |  __________   |
    | |\|          |  |
    | |      ____  |  |
    | |___|\|    |_|  |
    |  ___  | R0 |_   |
    | |   |/|____| |  |
    | |      ____  |  |
    | |___|\|    |_|  |
    |  ___  | R1 |_   |
    | |   |/|____| |  |
    | |             \/
    | |      ....  .  .
    | |      ____  .  .
    | |___|\|    |_|\/|
    |  ___  | R7 |____|
    | |   |/|____|
    | |

    The register module has a total of 8 74HC574 registers wired up in
    parallel and connected to the data bus.

    A 3 bit read and a 3 bit write select are decoded by two 74HC138 ICs,
    with one positive enable control line for each connected to the bus.

    This setup allows latching bus contents to an arbitrary register, writing
    an arbitrary register to the bus, or transfering data from one register
    to another in a single step.

  5) Constant module

                                        VCC
    BUS                                  A
    | |     ___________    Diode Matrix  |
    | |    |           |---|-|-|-|-|-|-|-+
    | |    |           |---|-|-|-|-|-|-|-+
    | |/|__|           |---|-|-|-|-|-|-|-+
    | |  __| Tri-state |---|-|-|-|-|-|-|-+
    | |\|  |   Buffer  |---|-|-|-|-|-|-|-+
    | |    |           |---|-|-|-|-|-|-|-+
    | |    |           |---|-|-|-|-|-|-|-+
    | |    |___________|---|-|-|-|-|-|-|-+
    | |                   _|_|_|_|_|_|_|_
    | |                  |               |
    | |----------------->| Column-Select |
    | |                  |_______________|


    The constant module allows writing numeric constants to the bus. It reuses
    the read select lines of the register module to select a constant.
    A 74HC138 is used to decode the selected constant through a diode matrix.

    Since the constant values are different for lower and higher order bytes,
    the diode rows have to be soldered in different ways for the intended use
    of the module.

    The currently intended constants are:

        000:  0
        001: +1     (for incrementing using the adder)
        010: -1     (for decrementing using the adder)
        011:  2     (address of interrupt vector)
        100:  4     (address of syscall vector)
        101:
        110:
        110:

  6) Memory & I/O module

     BUS
     | |
     | |/|______________________________________________
     | |  ____________________________________________  |
     | |\|   ___      ________         ___________    | |
     | |__|\|   |__|\|        |/|___|\|           |/|_| |
     | |__  | A |__  | MEMORY |  ___  | Tri-state |  _  |
     | |  |/|___|  |/|________|\|   |/|   Buffer  |\| | |
     | |         Address      Data    |___________|   | |
     | |                                              | |
     | |     ___      _________        ___________    | |
     | |__|\|   |__|\|         |/|__|\|           |/|_| |
     | |__  | A |__  | I/O BUS |  __  | Tri-state |  ___|
     | |  |/|___|  |/|_________|\|  |/|   Buffer  |\|
     | |         Address      Data    |___________|
     | |


    The Memory & I/O module connects the CPU to the external memory & I/O
    bus. The A register holds the memory or I/O device address, a tri-state
    buffer is used to connect either the external data bus to the internal
    bus or vice-versa (74HC245, direction controlable).

    The actual memory request, I/O request and read/write lines are output
    directly by the control logic.

  7) Decode module

    The decode module decodes a 4 bit selector and 2 control signals from the
    control logic to control signals for the CPU internal bus as well as
    control signals for the I/O bus.

    The CPU internal bus has a seperate output enable line for each module,
    but only one can be selected at a time. Doing otherwise would damage the
    output drivers. The decode module decodes a 4 bit selector to the output
    enable lines for the modules. Two values of the 16 selectors are reserved
    for memory read and I/O read. For those selectors, the board generates the
    necessary signals for the memory & I/O module, as well as the propper
    control singnals for the external I/O bus.

    In addition, the control logic supplies the memory write and I/O write
    signals that also trigger the apropriate control lines for the memory &
    I/O module.

    The decode module does not have to be built symetrically. Only one has to
    be installed, as the control lines can be simply rippled through to the
    second half of the bus.

